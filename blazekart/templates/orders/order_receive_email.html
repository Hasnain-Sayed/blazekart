{% load static %}
{% load tz %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Order Confirmation</title>
</head>
<body style="font-family: Arial, sans-serif; background-color:#f5f5f5; margin:0; padding:0;">

    <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
            <td align="center">

                <!-- Main Card -->
                <table width="600" cellpadding="0" cellspacing="0" border="0" 
                       style="background-color:#ffffff; border-radius:8px; margin-top:20px; padding:20px;">

                    <!-- Header Title -->
                    <tr>
                        <td>
                            <h2 style="text-align:center; color:#333; margin:0;">
                                Order Confirmation
                            </h2>
                            <hr style="border:none; border-top:1px solid #eaeaea; margin:15px 0;">
                        </td>
                    </tr>

                    <tr>
                        <td>

                            <!-- Greeting -->
                            <p style="font-size:16px; margin:0;">Hi {{ user.first_name }},</p>
                            <p style="font-size:15px; margin:10px 0 20px 0;">
                                Thank you for your order! Your purchase has been successfully placed.
                            </p>

                            <!-- Unique ID -->
                            <p style="font-size:12px; color:#555; margin-bottom:15px;">
                                Your Payment ID is <strong>{{ payment_id }}</strong>.
                            </p>

                            <!-- Summary -->
                            <h3 style="margin-bottom:5px; color:#333;">Order Summary</h3>
                            <p style="margin:3px 0;">
                                <strong style="color:#111;">Order Number:</strong> {{ order.order_number }}
                            </p>
                            <p style="margin:3px 0;">
                                <strong style="color:#111;">Order Date:</strong> {{ order.created_at|localtime|date:"d M Y, h:i A" }}
                            </p>
                            <p style="margin:3px 0;">
                                <strong style="color:#111;">Total Amount Paid:</strong> ${{ order.order_total }}
                            </p>

                            <!-- Product Table -->
                            <h4 style="margin-top:20px; color:#333;">Products:</h4>

                            <table width="100%" cellpadding="5" cellspacing="0" border="1" 
                                   style="border-collapse:collapse; border-color:#ddd;">
                                <tr style="background-color:#f2f2f2;">
                                    <th align="left" style="padding:8px;">Product</th>
                                    <th align="center" style="padding:8px;">Quantity</th>
                                    <th align="right" style="padding:8px;">Price</th>
                                    <th align="left" style="padding:8px;">Variations</th>
                                </tr>

                                {% for product in products %}
                                <tr>
                                    <td style="padding:8px 5px;">{{ product.name }}</td>
                                    <td align="center" style="padding:8px 5px;">{{ product.quantity }}</td>
                                    <td align="right" style="padding:8px 5px;">${{ product.price }}</td>

                                    <!-- Variation Logic (unchanged) -->
                                    <td style="padding:8px 5px;">
                                        {% if product.variations %}
                                            {% for v in product.variations %}
                                                {% if v %}
                                                    {{ v|safe }}<br>
                                                {% else %}
                                                    No Variation<br>
                                                {% endif %}
                                            {% endfor %}
                                        {% else %}
                                            No Variation
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}

                            </table>

                            <!-- Spacing -->
                            <div style="height:25px;"></div>

                            <!-- Footer Message -->
                            <table width="100%" cellpadding="15" cellspacing="0" border="0" 
                                   style="background-color:#e8f4fd; border-radius:6px;">
                                <tr>
                                    <td style="font-size:15px; line-height:22px; color:#333; font-weight:bold;">
                                        ðŸšš Weâ€™ll notify you once your order is shipped.  
                                        <br><br>
                                        Thanks for shopping with us!  
                                        <br>
                                        <strong>BlazeKart Team</strong>
                                    </td>
                                </tr>
                            </table>

                            <!-- Hidden Anti-Gmail-Clipping Note -->
                            <p style="font-size:1px; line-height:0; height:0; overflow:hidden;">
                                Order ID: {{ order.order_number }} | {{ user.email }}
                            </p>

                        </td>
                    </tr>

                </table>

            </td>
        </tr>
    </table>

</body>
</html>
