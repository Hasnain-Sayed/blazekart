{% extends "base.html" %}
{% load static %}
{% block content %}

<section class="section-content padding-y bg">
<div class="container">



{% if cart_items %}
<section class="section-content padding-y bg">
<div class="container">

<style>
/* ================= CART STYLING ================= */
.card.cart-card {
    border-radius: 12px;
    background-color: #f7f7f7 !important;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    padding: 20px;
    margin-bottom: 30px;
    transition: 0.3s;
}

.card.cart-card:hover {
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

/* ================= HEADING ================= */
h3.section-heading {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.6rem;
    font-weight: 700;
    margin-top: 0;
    margin-bottom: 20px;
    color: #222;
}

h3.section-heading i {
    font-size: 1.3rem;
    color: #3f9edd;
}

/* ================= TABLE ================= */
table.table-shopping-cart {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px; /* space between rows */
}

table.table-shopping-cart th,
table.table-shopping-cart td {
    vertical-align: middle;
    padding: 12px 15px;
    border: none;
}

table.table-shopping-cart th {
    font-weight: 600;
    color: #555;
    text-transform: uppercase;
    font-size: 0.9rem;
}

table.table-shopping-cart tbody tr {
    background: #f9f9f9;
    border-radius: 10px;
}

table.table-shopping-cart td {
    font-size: 0.95rem;
    color: #333;
}

/* ================= PRODUCT IMAGE ================= */
.itemside .aside img {
    border-radius: 8px;
    width: 70px;
    height: 70px;
    object-fit: cover;
}

/* ================= PRODUCT INFO ================= */
.itemside .info a.title {
    font-weight: 600;
    font-size: 1rem;
    color: #222;
    transition: 0.3s;
}

.itemside .info a.title:hover {
    color: #3f9edd;
    text-decoration: underline;
}

.itemside .info p {
    margin: 3px 0;
    font-size: 0.85rem;
    color: #555;
}

/* ================= BUTTONS ================= */
/* Move to Wishlist Button */
.btn-info,
.btn-info.btn-sm {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    border: none;
    color: white;
    font-weight: 600;
    padding: 6px 14px !important;
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
}

.btn-info:hover,
.btn-info.btn-sm:hover {
    background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    color: white;
}

/* Move to Cart Button (Green) */
.btn-success,
.btn-success.btn-sm {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
    color: white;
    font-weight: 600;
    padding: 6px 14px !important;
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}

.btn-success:hover,
.btn-success.btn-sm:hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    color: white;
}

/* Remove Item Button */
.btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    border: none;
    color: white;
    font-weight: 600;
    padding: 6px 14px !important;
    border-radius: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.btn-danger:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
    color: white;
}

/* Ensure action buttons container is properly aligned */
.action-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    align-items: center;
    flex-wrap: nowrap;
}

.action-buttons .btn {
    font-size: 0.85rem !important;
    height: auto;
    line-height: 1.4;
    white-space: nowrap;
}
.table-shopping-cart .btn-light {
    border: 1px solid #ccc;
    background: #fff;
    font-size: 0.85rem;
    padding: 5px 10px;
    border-radius: 6px;
    transition: 0.3s;
}

.table-shopping-cart .btn-light:hover {
    background-color: #3f9edd;
    color: #fff;
}

/* ================= PRICE ================= */
.price-wrap var.price {
    font-weight: 600;
    font-size: 1rem;
    color: #222;
}

.price-wrap small {
    color: #777;
    font-size: 0.8rem;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
    table.table-shopping-cart thead {
        display: none;
    }

    table.table-shopping-cart tbody tr {
        display: block;
        margin-bottom: 15px;
        border-bottom: none;
    }

    table.table-shopping-cart td {
        display: flex;
        justify-content: space-between;
        padding: 8px 5px;
    }

    table.table-shopping-cart td:before {
        content: attr(data-label);
        font-weight: 600;
        color: #555;
        flex: 1;
    }

    .itemside .aside img {
        width: 55px;
        height: 55px;
    }
}


/* ================= CHECKOUT BUTTON ================= */
.btn-primary.btn-block {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    border: none;
    color: white;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 12px 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    transition: all 0.3s ease;
}

.btn-primary.btn-block:hover {
    background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
}

.btn-primary.btn-block:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
}

/* ================= CONTINUE SHOPPING BUTTON ================= */
.btn-light.btn-block {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    color: #0f172a;
    font-weight: 600;
    padding: 12px 20px;
    border-radius: 12px;
    transition: all 0.3s ease;
}

.btn-light.btn-block:hover {
    background: #eef2ff;
    border-color: #c7d2fe;
    color: #4f46e5;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
}
</style>

<div class="row">
    <aside class="col-lg-9">
        <div class="card cart-card">
            <h3 class="section-heading">My Cart <i class="fas fa-shopping-cart"></i></h3>
            <table class="table table-borderless table-shopping-cart">
                <thead class="text-muted">
                    <tr class="small text-uppercase">
                      <th scope="col">Product</th>
                      <th scope="col" width="120">Quantity</th>
                      <th scope="col" width="120">Price</th>
                      <th scope="col" class="text-right" width="200"></th>
                    </tr>
                </thead>
                <tbody>
                {% for cart_item in cart_items %}
                <tr>
                    <td>
                        <figure class="itemside align-items-center">
                            <div class="aside"><img src="{{ cart_item.product.images.url }}" class="img-sm"></div>
                            <figcaption class="info">
                                <a href="{% url 'product_details' cart_item.product.category.slug cart_item.product.prod_slug %}" class="title text-dark">{{ cart_item.product.product_name }}</a>

                                {% for var in cart_item.variations.all %}
                                <p class="text-muted small bold"><strong>{{ var.variation_category }} : {{ var.variation_value }}</strong></p>
                                {% endfor %}

                            </figcaption>
                        </figure>
                    </td>
                    <td> 
                        <div class="col" style="max-width:150px;"> 
                            <div style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                                <a href="{% url 'reduce_cart_item' cart_item.product.id cart_item.id %}" class="btn btn-light"> <i class="fa fa-minus"></i> </a>

                            <form action="{% url 'update_cart' cart_item.product.id cart_item.id %}" method='POST'>
                            {% csrf_token %}
                                <input type="text" pattern="\d*" name="input_box" class="form-control text-center" value="{{cart_item.quantity}}" style=" width: 50px; padding: 2px 5px; ">
                            </form>
                            
                            <form method="POST" action="{% url 'add_cart' cart_item.product.id %}">
                            {% csrf_token %}
                            {% for item in cart_item.variations.all %}
                                <input type="hidden" name="{{item.variation_category}}" value="{{item.variation_value}}">
                            {% endfor %}
                                <button type="submit" class="btn btn-light"><i class="fa fa-plus"></i></button>
                            </form>
                            </div>
                        </div>
                    </td>
                    <td> 
                        <div class="price-wrap"> 
                            <var class="price">${{cart_item.subtotal}}</var> 
                            <small class="text-muted"> ${{cart_item.product.price}} each </small> 
                        </div>
                    </td>
                    <td class="text-right"> 
					  <div class="action-buttons">
						<a href="{% url 'move_to_wishlist' cart_item.product.id cart_item.id %}" class="btn btn-info btn-sm">Move to Wishlist</a>
                        <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" class="btn btn-danger">Remove Item</a>
					  </div>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
			
        </div> <!-- card.// -->
    </aside>
	
<aside class="col-lg-3">

		<div class="card">
		<div class="card-body">
			<dl class="dlist-align">
			  <dt>Total price:</dt>
			  <dd class="text-right">${{total}}</dd>
			</dl>
			<dl class="dlist-align">
			  <dt>Tax:</dt>
			  <dd class="text-right"> ${{tax}}</dd>
			</dl>
			<dl class="dlist-align">
			  <dt>Grand Total:</dt>
			  <dd class="text-right text-dark b"><strong>${{final_total}}</strong></dd>
			</dl>
			<hr>
			<p class="text-center mb-3">
				<img src=" {% static './images/misc/payments.png' %} " height="26">
			</p>
			<a href="{% url 'checkout' %}" class="btn btn-primary btn-block"> Checkout </a>
			<a href="{% url 'store' %}" class="btn btn-light btn-block">Continue Shopping</a>
		</div> <!-- card-body.// -->
		</div> <!-- card.// -->

</aside> <!-- col.// -->

</div> <!-- row.// -->

</div> <!-- container.// -->
</section>
{% endif %}
{% if wishlistitems %}

<style>
    /* Wishlist heading same as My Cart */
    .wishlist-heading {
        margin: 20px 0;
        font-weight: 700;
        font-size: 26px;
    }

    /* Wishlist card spacing */
    .wishlist-card {
        background-color: #edeceaff !important; /* change this to any color you want */
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 12px;
    }

    /* Wishlist item image */
    .wishlist-card .img-sm {
        width: 80px;
        height: 80px;
        object-fit: cover;
    }

    /* Wishlist product title */
    .wishlist-card .title {
        font-size: 17px;
        font-weight: 600;
    }

    /* Wishlist variation text */
    .wishlist-card .bold strong {
        font-weight: 700;
    }
	.action-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    align-items: center;
    flex-wrap: nowrap;
}

.action-buttons .btn {
    padding: 5px 10px !important;  /* same padding for all buttons */
    font-size: 0.85rem !important; /* same font size */
    height: 32px; /* optional: fix height so they align perfectly */
    line-height: 1.2; 
    white-space: nowrap;
}

</style>

<div class="card wishlist-card mb-4">
<h3 class="wishlist-heading">My Wishlist <i class="fas fa-bookmark"> </i></h3>

<table class="table table-borderless table-shopping-cart">
<thead class="text-muted">
<tr class="small text-uppercase">
  <th scope="col">Product</th>
  <th scope="col" width="120">Quantity</th>
  <th scope="col" width="120">Price</th>
  <th scope="col" class="text-right" width="200"></th>
</tr>
</thead>

<tbody>
{% for item in wishlistitems %}
<tr>
    <td>
        <figure class="itemside align-items-center">
            <div class="aside"><img src="{{ item.product.images.url }}" class="img-sm"></div>
            <figcaption class="info">
                <a href="{% url 'product_details' item.product.category.slug item.product.prod_slug %}" class="title text-dark">
                    {{ item.product.product_name }}
                </a>

                {% for var in item.variations.all %}
                <p class="text-muted small bold"><strong>{{ var.variation_category }} : {{ var.variation_value }}</strong></p>
                {% endfor %}
            </figcaption>
        </figure>
    </td>

    <td>{{ item.quantity }}</td>

    <td>${{ item.product.price }}</td>

    <td class="text-right">
	  <div class="action-buttons">
	    <a href="{% url 'move_to_cart' item.product.id item.id %}" class="btn btn-success btn-sm">Move to Cart</a>
        <a href="{% url 'remove_wishlist_item' item.product.id %}" class="btn btn-danger">Remove Item</a>
	  </div>
    </td>
</tr>
{% endfor %}
</tbody>
</table>

</div>
{% endif %}

{% if stock_limit_reached %}
<style>
  /* =================== STOCK LIMIT TOAST =================== */
  #stock-toast {
    position: fixed;
    top: 20px;
    right: 40%;
    background: linear-gradient(135deg, #ff6b6b, #ff4d4f);
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    font-weight: 600;
    font-family: Arial, sans-serif;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.5s ease;
    z-index: 9999;
  }

  #stock-toast.show {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<div id="stock-toast">
  ⚠️ Stock limit reached! Quantity adjusted to available stock.
</div>

<script>
  const toast = document.getElementById('stock-toast');
  toast.classList.add('show');

  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 500);
  }, 3000); // hides after 3 seconds
</script>
{% endif %}


{% if not cart_items and not wishlistitems %}

<div style="text-align: center; padding: 40px;">
    <img src="{% static 'images/Emptycart.png' %}" 
         alt="Empty Cart"
         style="width: 200px; margin-bottom: 20px;">

    <h2>Your cart is empty</h2>

    <a href="{% url 'store' %}" 
       style="
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #5044d2;
            color: white;
            text-decoration: none;
            border-radius: 5px;
			transition: 0.4s;
       "
	   	onmouseover="this.style.backgroundColor='#5a53b0'"
   		onmouseout="this.style.backgroundColor='#5044d2'">
        Let's add something
    </a>
</div>

{% endif %}

</section>
</div>

{% endblock  %}
